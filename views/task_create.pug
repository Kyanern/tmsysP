html
  head 
    title="Task Management System"
    link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous")
    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous")
    script(src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous")
  body
    div(class="container")
      h2(class="pb-2 border-bottom")="Task Management System - Create Task"
        if isLoggedIn
          a(class="btn btn-link" href="/logout")="Logout"

      if error
        p(class="alert alert-danger")=error

      if errorSpecial
        p(class="alert alert-danger")=errorSpecial

      if success
        p(class="alert alert-success")=success

      div(class="row")
        div(class="col")
          a(class="btn btn-link" href="/tmsys")="Back to menu"
      hr

      form(method="post" action="")
        label(for="taskAppAcronym" class="col-2 col-form-label")="For Application:"
        select#taskAppAcronym(class="form-select" aria-label="Select application" name="Task_app_Acronym")
          for a in appList
            option(value=a.App_Acronym)=a.App_Acronym
        label(for="taskPlan" class="col-2 col-form-label")="For Plan:"
        select#taskPlan(class="form-select" aria-label="Select plan" name="Task_plan")
        label(for="taskName" class="form-label")="Task Name"
        input#taskName(type="text" name="Task_name" class="form-control" )
        label(for="taskDescription" class="form-label")="Task Description:"
        textarea#taskDescription(rows="6" name="Task_description" class="form-control" )
        button(type="submit" class="btn btn-primary" name="btn_createTask" value=true)="Create Task"

    script.
      var $jq = jQuery.noConflict();
      var sel_app;
      var sel_plan;
      var hdl_updatePlanList = function(selPlan){
        //- GET request to server for Plan list
        $jq.ajax({
          url: "create",
          data: {
            requestFrom: "createTaskSelApp",
            value: sel_app.val()
          },
          type: "GET",
          dataType: "json",
          cache: false
        })
        .done(function(json){
          if(json.error){
            var errorstring = "Could not retrieve plan list from server (" + json.error + ")";
            alert(errorstring);
            console.log(errorstring);
            return;
          }
          console.dir(json);
          //- empty out existing selections in plan list
          //- then construct new selections and append to "select" element
          sel_plan.empty();
          sel_plan.append("<option selected=\"selected\" value=\"\">(not applicable)</option>");
          for(var i = 0; i < json.length; i++){
            var htmlStr = "<option value=\"" + json[i].name + "\">" + json[i].name + "</option>";
            sel_plan.append(htmlStr);
          }
        })
        .fail(function(xhr, status, errorThrown){
          console.log( "Error: " + errorThrown );
          console.log( "Status: " + status );
          console.dir( xhr );
        })
      };
      $jq(document).ready(function(){
        //-console.log("document loaded");
        sel_app = $jq("#taskAppAcronym");
        sel_plan = $jq("#taskPlan");
        hdl_updatePlanList(sel_plan);
        sel_app.change(sel_plan, hdl_updatePlanList);
      });